
<!DOCTYPE html>
<html class=" ">
    <head>
        <!-- 
         * @Package: Ultra Admin - Responsive Theme
         * @Subpackage: Bootstrap
         * @Version: B4-1.3
         * This file is part of Ultra Admin Theme.
        -->
        <meta http-equiv="content-type" content="text/html;charset=UTF-8" />
        <meta charset="utf-8" />
        <title>Salestraka : Manage Users</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
        <meta content="" name="description" />
        <meta content="" name="author" />

        <link rel="shortcut icon" href="assets/images/favicon.png" type="image/x-icon" />    <!-- Favicon -->
        <link rel="apple-touch-icon-precomposed" href="assets/images/apple-touch-icon-57-precomposed.png">	<!-- For iPhone -->
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="assets/images/apple-touch-icon-114-precomposed.png">    <!-- For iPhone 4 Retina display -->
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="assets/images/apple-touch-icon-72-precomposed.png">    <!-- For iPad -->
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="assets/images/apple-touch-icon-144-precomposed.png">    <!-- For iPad Retina display -->




        <!-- CORE CSS FRAMEWORK - START -->
        <link href="assets/plugins/pace/pace-theme-flash.css" rel="stylesheet" type="text/css" media="screen"/>
        <link href="assets/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
        <link href="assets/fonts/font-awesome/css/font-awesome.css" rel="stylesheet" type="text/css"/>
        <link href="assets/css/animate.min.css" rel="stylesheet" type="text/css"/>
        <link href="assets/plugins/perfect-scrollbar/perfect-scrollbar.css" rel="stylesheet" type="text/css"/>
        <!-- CORE CSS FRAMEWORK - END -->

        <!-- OTHER SCRIPTS INCLUDED ON THIS PAGE - START --> 
        <link href="assets/plugins/datatables/css/datatables.min.css" rel="stylesheet" type="text/css" media="screen"/>        <!-- OTHER SCRIPTS INCLUDED ON THIS PAGE - END --> 


        <!-- CORE CSS TEMPLATE - START -->
        <link href="assets/css/style.css" rel="stylesheet" type="text/css"/>
        <link href="assets/css/responsive.css" rel="stylesheet" type="text/css"/>
        <link rel="stylesheet" href="assets/css/actions.css">
        <!-- CORE CSS TEMPLATE - END -->

    </head>
    <!-- END HEAD -->

    <!-- BEGIN BODY -->
    <body class=" "><!-- START TOPBAR -->
        <div class='page-topbar '>
            <div class='logo-area'>

            </div>
            <div class='quick-area'>
                <div class='float-left'>
                    <ul class="info-menu left-links list-inline list-unstyled">
                        <li class="sidebar-toggle-wrap list-inline-item">
                            <a href="#" data-toggle="sidebar" class="sidebar_toggle">
                                <i class="fa fa-bars"></i>
                            </a>
                        </li>
                        <li class="message-toggle-wrapper list-inline-item">
                            
                            <ul class="dropdown-menu messages animated fadeIn">

                                <li class="list dropdown-item">

                                    <ul class="dropdown-menu-list list-unstyled ps-scrollbar">
                                        
                                    </ul>
                                </li>
                            </ul>

                        </li>
                        <li class="notify-toggle-wrapper list-inline-item">
                            
                            <ul class="dropdown-menu notifications animated fadeIn">
                                
                            </ul>
                        </li>
                        <li class="d-sm-none d-none searchform list-inline-item">
                            
                        </li>
                    </ul>
                </div>
                <div class='float-right'>
                    <ul class="info-menu right-links list-inline list-unstyled">
                        
                    </ul>			
                </div>		
            </div>				
            </div>

        </div>
        <!-- END TOPBAR -->
        <!-- START CONTAINER -->
        <div class="page-container row-fluid">

            <!-- SIDEBAR - START -->
            <div class="page-sidebar ">

                <!-- MAIN MENU - START -->
                <div class="page-sidebar-wrapper" id="main-menu-wrapper"> 

                    <!-- USER INFO - START -->
                    <div class="profile-info row">

                        <div class="profile-image col-lg-4 col-md-4 col-4">
                            <a href="profile.html">
                                <img src="data/profile/profile.png" class="img-fluid rounded-circle">
                            </a>
                        </div>

                        <div class="profile-details col-lg-8 col-md-8 col-8">

                            <h3>
                                <a href="profile.html">Jason Bourne</a>

                                <!-- Available statuses: online, idle, busy, away and offline -->
                                <span class="profile-status online"></span>
                            </h3>

                            <p class="profile-title">Web Developer</p>

                        </div>

                    </div>
                    <!-- USER INFO - END -->



                    <ul class='wraplist'>	


                        <li class="open"> 
                            <a href="index.html">
                                <i class="fa fa-dashboard"></i>
                                <span class="title">Dashboard</span>
                            </a>
                        </li>
                        
                        <li class=""> 
                            <a href="javascript:;">
                                <i class="fa fa-suitcase"></i>
                                <span class="title">PRODUCTS</span>
                                <span class="arrow "></span>
                            </a>
                            <ul class="sub-menu" >
                                <li>
                                    <a class="" href="add-products.html" >Add product</a>
                                </li>
                                <li>
                                    <a class="" href="manage-products.html" >Manage Products</a>
                                </li>
                            </ul>
                        </li>
                        <li class=""> 
                            <a href="javascript:;">
                                <i class="fa fa-suitcase"></i>
                                <span class="title">USERS</span>
                                <span class="arrow "></span>
                            </a>
                            <ul class="sub-menu" >
                                <li>
                                    <a class="" href="register-user.html" >Register User</a>
                                </li>
                                <li>
                                    <a class="" href="manage-users.html" >Manage Users</a>
                                </li>
                            </ul>
                        </li>
                        <li class=""> 
                            <a href="javascript:;">
                                <i class="fa fa-sliders"></i>
                                <span class="title">SALES</span>
                                <span class="arrow "></span>
                            </a>
                            <ul class="sub-menu" >
                                <li>
                                    <a class="" href="record-sale.html" >Record Sale</a>
                                </li>
                                <li>
                                    <a class="" href="manage-branch-sales.html" >Manage Branch Sales</a>
                                </li>
                                <li>
                                    <a class="" href="manage-general-sales.html" >Manage General Sales</a>
                                </li>
                            </ul>
                        </li>
                        <li class=""> 
                            <a href="javascript:;">
                                <i class="fa fa-gift"></i>
                                <span class="title">RETURNS</span>
                                <span class="arrow "></span>
                            </a>
                            <ul class="sub-menu" >
                                <li>
                                    <a class="" href="record-return.html" >Record Return</a>
                                </li>
                                <li>
                                    <a class="" href="manage-branch-returns.html" >Manage Branch Returns</a>
                                </li>
                                <li>
                                    <a class="" href="manage-general-returns.html" >Manage General Returns</a>
                                </li>
                            </ul>
                        </li>
                        <li class=""> 
                            <a href="javascript:;">
                                <i class="fa fa-bar-chart"></i>
                                <span class="title">INVENTORY</span>
                                <span class="arrow "></span>
                            </a>
                            <ul class="sub-menu" >
                                <li>
                                    <a class="" href="add-to-inventory.html" >Add to Inventory</a>
                                </li>
                                <li>
                                    <a class="" href="manage-branch-inventory.html" >Manage Branch Inventory</a>
                                </li>
                                <li>
                                    <a class="" href="manage-general-inventory.html" >Manage General Inventory</a>
                                </li>
                            </ul>
                        </li>
                        <li class=""> 
                            <a href="javascript:;">
                                <i class="fa fa-lock"></i>
                                <span class="title">BRANCHES</span>
                                <span class="arrow "></span>
                            </a>
                            <ul class="sub-menu" >
                                <li>
                                    <a class="" href="create-branch.html" >Create Branch</a>
                                </li>
                                <li>
                                    <a class="" href="manage-branches.html" >Manage Branches</a>
                                </li>
                            </ul>
                        </li>
                        <li class=""> 
                            <a href="settings.html">
                                <i class="fa fa-lock"></i>
                                <span class="title">SETTINGS</span>
                            </a>
                        </li>
                        <li class=""> 
                            <a href="login.html">
                                <i class="fa fa-lock"></i>
                                <span class="title">LOGOUT</span>
                            </a>
                        </li>
                    </ul>

                </div>
                <!-- MAIN MENU - END -->

                <div class="project-info">

                </div>

            </div>
            <!--  SIDEBAR - END -->
            <!-- START CONTENT -->
            <section id="main-content" class=" ">
                <section class="wrapper main-wrapper">

                    <div class='col-xl-12 col-lg-12 col-md-12 col-12'>
                        <div class="page-title">

                            <div class="float-left">
                                <h1 class="title">Manage Users</h1>                            
                            </div>

                        </div>
                    </div>
                    <div class="clearfix"></div>

                    <div class="col-xl-12">
                        <section class="box ">
                            <div class="content-body">    <div class="row">
                                    <div class="col-lg-12 col-md-12 col-12 padding-0">

                                        <table id="users_list" class="table table-striped dt-responsive display" cellspacing="0" width="100%">
                                            <thead>
                                                <tr>
                                                    <th>Full Name</th>
                                                    <th>Branch</th>
                                                    <th>Role</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tfoot>
                                                <tr>
                                                    <th>Full Name</th>
                                                    <th>Branch</th>
                                                    <th>Role</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </tfoot>
                                            <tbody id="users_list_body">
                                                
                                            </tbody>
                                        </table>

                                    </div>
                                </div>
                            </div>
                        </section>
                    </div>

                </section>
            </section>
            <!-- END CONTENT -->
        <!-- END CONTAINER -->
        <!-- LOAD FILES AT PAGE END FOR FASTER LOADING -->


        <!-- CORE JS FRAMEWORK - START --> 
        <script src="assets/js/jquery-3.4.1.min.js" type="text/javascript"></script> 
        <script src="assets/js/popper.min.js" type="text/javascript"></script> 
        <!-- <script src="assets/js/jquery.easing.min.js" type="text/javascript"></script>  -->
        <script src="assets/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script> 
        <script src="assets/plugins/pace/pace.min.js" type="text/javascript"></script>  

        <script src="assets/plugins/perfect-scrollbar/perfect-scrollbar.min.js" type="text/javascript"></script> 
        <script src="assets/plugins/viewport/viewportchecker.js" type="text/javascript"></script>  
        <!-- CORE JS FRAMEWORK - END --> 


        <!-- OTHER SCRIPTS INCLUDED ON THIS PAGE - START --> 
        <script src="assets/plugins/datatables/js/dataTables.min.js" type="text/javascript"></script> <script type="text/javascript" language="javascript" src="https://cdn.datatables.net/buttons/1.5.1/js/dataTables.buttons.min.js">
        </script>
        <script type="text/javascript" language="javascript" src="//cdn.datatables.net/buttons/1.5.1/js/buttons.flash.min.js">
        </script>
        <script type="text/javascript" language="javascript" src="//cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js">
        </script>
        <script type="text/javascript" language="javascript" src="//cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.32/pdfmake.min.js">
        </script>
        <script type="text/javascript" language="javascript" src="//cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.32/vfs_fonts.js">
        </script>
        <script type="text/javascript" language="javascript" src="//cdn.datatables.net/buttons/1.5.1/js/buttons.html5.min.js">
        </script>
        <script type="text/javascript" language="javascript" src="//cdn.datatables.net/buttons/1.5.1/js/buttons.print.min.js">
        </script> <!-- OTHER SCRIPTS INCLUDED ON THIS PAGE - END --> 


        <!-- CORE TEMPLATE JS - START --> 
        <script src="assets/js/scripts.js" type="text/javascript"></script> 
        <!-- END CORE TEMPLATE JS - END --> 

        <!-- Sidebar Graph - START --> 
        <script src="assets/plugins/sparkline-chart/jquery.sparkline.min.js" type="text/javascript"></script>
        <script src="assets/js/chart-sparkline.js" type="text/javascript"></script>
        <!-- Sidebar Graph - END --> 

        <script>
            document.addEventListener('DOMContentLoaded', function () {
                // Function to fetch users and populate the table
                function populateUsersTable() {
                    // Get the access token from sessionStorage
                    let accessToken = sessionStorage.getItem('access');

                    if (accessToken) {
                        accessToken = accessToken.replace(/^"|"$/g, '').trim();  // Remove extra quotes and trim spaces
                    }

                    if (!accessToken) {
                        alert("No access token found. Please log in.");
                        return;
                    }

                    // Fetch users from the endpoint
                    fetch('http://localhost:8000/api/salestrakav2/users/', {
                        method: 'GET',
                        headers: {
                            'Authorization': `Bearer ${accessToken}`,
                            'Content-Type': 'application/json',
                        }
                    })
                    .then(response => response.json())
                    .then(users => {
                        // Check if users data is an array
                        if (Array.isArray(users)) {
                            const tableBody = document.getElementById('users_list_body');
                            tableBody.innerHTML = ''; // Clear any existing rows

                            // Loop through each user and create a row
                            users.forEach(user => {
                                const row = document.createElement('tr');

                                // Fetch the branch name based on branchid
                                fetch(`http://localhost:8000/api/salestrakav2/branches/${user.branchid}/`, {
                                    method: 'GET',
                                    headers: {
                                        'Authorization': `Bearer ${accessToken}`,
                                        'Content-Type': 'application/json',
                                    }
                                })
                                .then(response => response.json())
                                .then(branch => {
                                    // Create Full Name column (firstname lastname)
                                    const fullNameCell = document.createElement('td');
                                    fullNameCell.textContent = `${user.firstname} ${user.lastname}`;
                                    row.appendChild(fullNameCell);

                                    const branchCell = document.createElement('td');
                                    branchCell.textContent = branch ? branch.branchname : 'No Branch';  // Handle null or undefined branch
                                    row.appendChild(branchCell);

                                    // Create Role column
                                    const roleCell = document.createElement('td');
                                    roleCell.textContent = user.role;
                                    row.appendChild(roleCell);

                                    // Create Actions column with Edit and Delete buttons
                                    const actionsCell = document.createElement('td');
                                    actionsCell.innerHTML = `
                                        <button class="btn btn-info btn-sm" onclick="viewUser(${user.id})" style="margin-right: 5px;">View</button>
                                        <button class="btn btn-primary btn-sm" onclick="editUser(${user.id})" style="margin-right: 5px;">Edit</button>
                                        <button class="btn btn-danger btn-sm" onclick="deleteUser(${user.id})">Delete</button>
                                    `;
                                    row.appendChild(actionsCell);

                                    // Append the row to the table body
                                    tableBody.appendChild(row);
                                })
                                .catch(error => {
                                    console.error('Error fetching branch:', error);
                                    // Create and append row even if branch data fetch fails
                                    const fullNameCell = document.createElement('td');
                                    fullNameCell.textContent = `${user.firstname} ${user.lastname}`;
                                    row.appendChild(fullNameCell);

                                    const branchCell = document.createElement('td');
                                    branchCell.textContent = 'Branch Inexistent';
                                    row.appendChild(branchCell);

                                    const roleCell = document.createElement('td');
                                    roleCell.textContent = user.role;
                                    row.appendChild(roleCell);

                                    const actionsCell = document.createElement('td');
                                    actionsCell.innerHTML = `
                                        <button class="btn btn-info btn-sm" onclick="viewUser(${user.id})" style="margin-right: 5px;">View</button>
                                        <button class="btn btn-primary btn-sm" onclick="editUser(${user.id})" style="margin-right: 5px;">Edit</button>
                                        <button class="btn btn-danger btn-sm" onclick="deleteUser(${user.id})">Delete</button>
                                    `;
                                    row.appendChild(actionsCell);

                                    // Append the row to the table body
                                    tableBody.appendChild(row);
                                });
                            });
                        } else {
                            console.error("Invalid response format or no users data found");
                        }
                    })
                    .catch(error => {
                        console.error('Error fetching users:', error);
                    });
                }

                // Call the function to populate the users table when the page loads
                populateUsersTable();
            });

        </script>
    </body>
</html>



